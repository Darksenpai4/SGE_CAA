# PR201

## Entorno de producción de desarrollo contenerizado

El archivo compose.yaml, tiene cuatro servicios: Dos postgres y odoo, llamados postgres_1, postgres_2, odoo1 y odoo2 respectivamente.

- El servicio **postgres_1** proporciona una base de datos PostgreSQL para Odoo en el entorno de desarrollo.
    - Dentro del servicio proporcionamos los datos para la imagen, el nombre del contenedor, las variables de entorno (nombre de la base de datos, usuario y contraseña), el volumen donde se va a montar fuera del contenedor
- El servicio **postgres_2** proporciona una base de datos PostgreSQL para Odoo en el entorno de producción.
    - Dentro del servicio proporcionamos los datos para la imagen, el nombre del contenedor, las variables de entorno (nombre de la base de datos, usuario y contraseña), el volumen donde se va a montar fuera del contenedor, distinto al directorio del desarrollo

- El servicio **odoo_1** levanta una instancia de Odoo 16 que se conecta a la base de datos de **postgres_1**
    - Dentro del servicio proporcionamos los datos para la imagen, el nombre del contenedor, las variables de entorno (nombre de la base de datos, usuario y contraseña), los puertos donde se podrá ver la interfaz (*8069 desde la máquina física*), los volúmenes donde se cargarán los módulos adicionales, el volumen donde se guardarán los archivos generados por Odoo, las dependencias y el comando para activar el modo desarrollador completo.

- El servicio **odoo_2** levanta una instancia de Odoo 16 que se conecta a la base de datos de **postgres_2**
    - Dentro del servicio proporcionamos los datos para la imagen, el nombre del contenedor, las variables de entorno (nombre de la base de datos, usuario y contraseña), los puertos donde se podrá ver la interfaz (*8070 desde la máquina física*), el volúmen donde se cargará el módulo adicional y las dependencias.

### Archivo compose.yaml

```yaml
services:
  postgres_1:
    image: postgres:14
    container_name: dbdesarrollo
    environment:
      - POSTGRES_DB=postgres
      - POSTGRES_USER=odoo
      - POSTGRES_PASSWORD=paso
    volumes:
      - ~/OdooDev/dataDev:/var/lib/postgresql/data

  postgres_2:
    image: postgres:14
    container_name: dbproduccion
    environment:
      - POSTGRES_DB=postgres
      - POSTGRES_USER=odoo
      - POSTGRES_PASSWORD=paso
    volumes:
      - ~/OdooDev/dataProd:/var/lib/postgresql/data

  odoo_1:
    image: odoo:16
    container_name: odooDesarrollo
    environment:
      - HOST=postgres_1
      - USER=odoo
      - PASSWORD=paso
    ports:
      - '8069:8069'
    volumes:
      - ~/OdooDev/volumesOdoo/addons:/mnt/extra-addons
      - ~/OdooDev/volumesOdoo/sessions:/var/lib/odoo/sessions
      - ~/OdooDev/volumesOdoo/filestore:/var/lib/odoo/filestore
    depends_on:
      - postgres_1
    command: --dev=all

  odoo_2:
    image: odoo:16
    container_name: odooProduccion
    environment:
      - HOST=postgres_2
      - USER=odoo
      - PASSWORD=paso
    ports:
      - '8070:8069'
    volumes:
      - ~/OdooDev/volumesOdoo/addons:/mnt/extra-addons
    depends_on:
      - postgres_2
```