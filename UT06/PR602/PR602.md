# PR602
## Campos de modelo
### Creacion de los campos
En esta tarea se pide: tipo de campos especiales del modelo en Odoo son los campos relacionales, que nos permiten establecer relaciones entre diferentes modelos, pudiendo ser estas relaciones de tres tipos: muchos a uno (Many2one), uno a muchos (One2many) y muchos a muchos (Many2many).

## Libros
* **Título:** Nombre del libro.
* **Autor:** Relación con el modelo de Autores.
* **Género:** Selección entre las siguientes opciones:
    * Novela
    * Drama
    * Ciencia ficción
    * Misterio
    * Terror
    * Histórico
* **Socios:** Relación (Many2many) con los socios que tienen o han tenido el libro prestado.

## Autores
* **Nombre:** Nombre completo del autor.
* **País de origen:** Relación con el modelo estándar de Odoo `res.country`.
* **Libros:** Relación (One2many) con los libros escritos por este autor.

## Socios 
* **Nombre:** Nombre del socio.
* **Teléfono:** Número de contacto.
* **Libros prestados:** Relación con los libros que el socio solicita.

### library_author_model.py
```py
# -*- coding: utf-8 -*-

from odoo import models, fields, api

class LibraryAuthor(models.Model):
    _name = 'library.author'
    _description = 'Autor'

    nombre = fields.Char(string='Nombre', required=True)
    pais = fields.Many2one(
        'res.country',
        string='País', 
    )
    libros = fields.Many2many(
        'library.book',
        string='libros'
    )
```

En este models lo mas importante a destacar es el uso de **fields.Many2one** el cual nos indica que tendremos una relacion de uno a muchos y **fields.Many2many** este lo ques nos indica es que tenemos una relacion muchos a muchos.

**pais**: En este campo lo que indicamos es que tendremos una relacion con *res.country* este lo que hace es poder marcar el pais de donde sera el autor.
```py
    pais = fields.Many2one(
        'res.country',
        string='País', 
    )
```

**libros**: Este campo lo relacionamos directamente con el models de libro
```py
    libros = fields.Many2many(
        'library.book',
        string='libros'
    )
```


### library_book_model.py
```py
# -*- coding: utf-8 -*-

from odoo import models, fields, api


class LibraryBook(models.Model):
    _name = 'library.book'
    _description = 'Libros'

    titulo = fields.Char(string='titulo', required=True)
    autor = fields.Many2many(
        comodel_name = 'library.author',
        relation = 'book_author_rel',
        column1 = 'book_titulo',
        column2 = 'author_nombre'
    )

    revisores = fields.Many2many(
        comodel_name='library.author',
        relation='book_reviewer_rel',
        column1='book_titulo',
        column2='author_nombre',
    )
    genero = fields.Many2one(
        comodel_name = 'library.genre',
        string='genero',
        ondelete='set null'
    )
 
    socios = fields.Many2many(
        'library.socios',
        string='socios'
    )
```

En este model encontramos lo siguientes:
- **fields.Many2many():** Encontramos 2 relaciones Many2many distintas con el modelo de autores donde una la uso para los autores principales y otra para los revisores.
    - **autores**
        ```py
        autor = fields.Many2many(
            comodel_name = 'library.author',
            relation = 'book_author_rel',
            column1 = 'book_titulo',
            column2 = 'author_nombre'
        )
    - **revisores**
        ```py
        revisores = fields.Many2many(
            comodel_name='library.author',
            relation='book_reviewer_rel',
            column1='book_titulo',
            column2='author_nombre',
        )
    - **socios**
        ```py
        socios = fields.Many2many(
            'library.socios',
            string='socios'
        )   
- **fields.Many2one:** Usamos un Many2one para asignar una categoría única al libro

### library_genre_model.py
```py
# -*- coding: utf-8 -*-

from odoo import models, fields


class LibraryGenre(models.Model):
    _name = 'library.genre'
    _description = 'Géneros'

    nombre = fields.Char(
        string='Nombre del género',
        required=True,
        help='Nombre del género literario, por ejemplo: Novela, Drama, Ciencia ficción...'
    )

    descripcion = fields.Text(
        string='Descripción',
        help='Descripción opcional del género literario'
    )

    # Relación inversa: libros que pertenecen a este género
    book_ids = fields.One2many(
        comodel_name='library.book',
        inverse_name='genero',
        string='Libros'
    )
```

En este model usamos una relación One2many para listar todos los libros que pertenecen a un genero

### library_socios_model.py
```py
# -*- coding: utf-8 -*-

from odoo import models, fields, api


class LibrarySocios(models.Model):
    _name = 'library.socios'
    _description = 'Socios'

    nombre = fields.Char(string='Nombre', required=True)
    telefono = fields.Char(string='Telefono')
    
    libros = fields.Many2many(
        comodel_name = 'library.book',
        string='Libros'
    )
```

En este model usamos una relación Many2many con libros, permitiendo ver qué libros ha solicitado o tiene vinculados cada socio.

## Archivos modificados
### Views
**author_views.xml**
```xml
<odoo>
  <data>
    <!-- explicit list view definition -->
 
    <record model="ir.ui.view" id="view_biblioteca_autor_tree">
      <field name="name">library.author.tree</field>
      <field name="model">library.author</field>
      <field name="arch" type="xml">
        <tree>
          <field name="nombre"/>
          <field name="pais"/>
          <field name="libros"/>
        </tree>
      </field>
    </record>
 
 
    <!-- actions opening views on models -->
 
    <record model="ir.actions.act_window" id="action_library_authors">
      <field name="name">Autores</field>
      <field name="res_model">library.author</field>
      <field name="view_mode">tree,form</field>
    </record>
  </data>
</odoo>
```

**book_views.xml**
```xml
<odoo>
  <data>
    <!-- explicit list view definition -->
 
    <record model="ir.ui.view" id="view_biblioteca_libros_tree">
      <field name="name">library.book.tree</field>
      <field name="model">library.book</field>
      <field name="arch" type="xml">
        <tree>
          <field name="titulo"/>
          <field name="autor"/>
          <field name="revisores"/>
          <field name="genero"/>
          <field name="socios"/>
        </tree>
      </field>
    </record>
 
 
    <!-- actions opening views on models -->
 
    <record model="ir.actions.act_window" id="action_library_books">
      <field name="name">Libros</field>
      <field name="res_model">library.book</field>
      <field name="view_mode">tree,form</field>
    </record>
  </data>
</odoo>
```

**genre_views.xml**
```xml
<odoo>
  <data>
    <!-- explicit list view definition -->
 
    <record model="ir.ui.view" id="view_biblioteca_genre_tree">
      <field name="name">library.genre.tree</field>
      <field name="model">library.genre</field>
      <field name="arch" type="xml">
        <tree>
          <field name="nombre"/>
          <field name="descripcion"/>
        </tree>
      </field>
    </record>
 
 
    <!-- actions opening views on models -->
 
    <record model="ir.actions.act_window" id="action_library_genres">
      <field name="name">Genero</field>
      <field name="res_model">library.genre</field>
      <field name="view_mode">tree,form</field>
    </record>
  </data>
</odoo>
```

**menu_views.xml**
```xml
<odoo>
  <data> 
    <!-- Top menu item -->
    <menuitem name="Library" id="menu_library_root"/>
 
    <!-- menu categories -->
 
    <menuitem name="Autores" id="library_menu_authors" parent="menu_library_root"/>
    <menuitem name="Libros" id="library_menu_book" parent="menu_library_root"/>
    <menuitem name="Socios" id="library_menu_socios" parent="menu_library_root"/>
    <menuitem name="Generos" id="library_menu_genres" parent="menu_library_root"/>
 
    <!-- actions -->
 
    <menuitem name="Listado de Autores" id="library_menu_authors_list" parent="library_menu_authors" action="action_library_authors"/>
    <menuitem name="Listado de Libros" id="library_menu_book_list" parent="library_menu_book" action="action_library_books"/>
    <menuitem name="Listado de Socios" id="library_menu_socios_list" parent="library_menu_socios" action="action_library_socios"/>
    <menuitem name="Listado de Generos" id="library_menu_genres_list" parent="library_menu_genres" action="action_library_genres"/>
 
  </data>
</odoo>
```

**socios_views.xml**
```xml
<odoo>
  <data>
    <!-- explicit list view definition -->
 
    <record model="ir.ui.view" id="view_biblioteca_socio_tree">
      <field name="name">library.socios.tree</field>
      <field name="model">library.socios</field>
      <field name="arch" type="xml">
        <tree>
          <field name="nombre"/>
          <field name="telefono"/>
          <field name="libros"/>
        </tree>
      </field>
    </record>
 
 
    <!-- actions opening views on models -->
 
    <record model="ir.actions.act_window" id="action_library_socios">
      <field name="name">Socios</field>
      <field name="res_model">library.socios</field>
      <field name="view_mode">tree,form</field>
    </record>
  </data>
</odoo>
```

**ir.model.access.csv**
```csv
id,name,model_id:id,group_id:id,perm_read,perm_write,perm_create,perm_unlink
access_library_author,access.library.author,model_library_author,base.group_user,1,1,1,1
access_library_book,access.library.book,model_library_book,base.group_user,1,1,1,1
access_library_genre,access.library.genre,model_library_genre,base.group_user,1,1,1,1
access_library_socios,access.library.socios,model_library_socios,base.group_user,1,1,1,1
```

## Funcionamiento
![Error de carga](./img/Library.jfif)